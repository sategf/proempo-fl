{% extends "base.html" %} {% block title %}Pomodoro{% endblock %} {% block content
    %}
    <div class="timer-container">
        <h1>Pomodoro Timer</h1>
        <div id="timer">25:00</div>
    
        <div class="button-container">
            <button id="startButton">Start</button>
            <button id="pauseButton">Pause</button>
            <button id="resetButton">Reset</button>
        </div>
    
        <div class="time-inputs">
            <div class="input-container">
                <label for="workTime">Work Time (min)</label>
                <input type="number" id="workTime" value="25">
            </div>
    
            <div class="input-container">
                <label for="shortBreakTime">Short Break (min)</label>
                <input type="number" id="shortBreakTime" value="5">
            </div>
    
            <div class="input-container">
                <label for="longBreakTime">Long Break (min)</label>
                <input type="number" id="longBreakTime" value="15">
            </div>
        </div>

        <div>
            <label for="taskSelection">In this session, I will work on:</label>
            <select id="taskSelection">
              <option value="" disabled selected>Select a task</option>
              {% for task in uncompleted_tasks %}
                <option value="{{ task.id }}">{{ task.data }}</option>
              {% endfor %}
            </select>
        </div>

        <div class="pomodoro-info">
            <a id="pomodoroInfoLink" href="#">What is Pomodoro?</a>
        </div>
            <div id="popup" class="popup">
            <div class="popup-content">
                <span class="close" id="closePopup">&times;</span>
                <p>The Pomodoro Technique is a time management method that uses a timer to break down work in intervals.</p>
                <p>5 easy steps:</p>
                <p>1. Decide on the task that you need to do</p>
                <p>2. Set the work time to 25 minutes (adjustable)</p>
                <p>3. Work on the set task until the timer rings</p>
                <p>4. Take a short 5 minute break (adjustable)</p>
                <p>5. After 4 cycles, take a longer break. </p>
            </div>
        </div>
        
    </div>
    
    
<style>
    body {
            text-align: center;
            margin: 0;
            padding: 0;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;

        }
        
    .timer-container {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        margin: 10vh auto;
        max-width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .button-container {
        display: flex;
        justify-content: space-between;
        width: 80%;
        margin-bottom: 10px;
    }

    .button-container button {
        flex-basis: calc(33.33%);
    }

    .time-inputs {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-bottom: 10px;
        width: 80%;
    }

    input[type="number"]:focus {
      outline: 2px solid #efddfb9c;
      background-color: #efddfb9c;
      border-radius: 2px;
    }

    .input-container {
        flex-basis: calc(33.33%);
        margin-bottom: 10px;
    }

    #pomodoroInfoLink {
        color: #8c83cf;
    }

    .popup {
        background-color: #8b7cb3;
        border-radius: 10px;
        color: rgb(253, 244, 244);
        width: 78%;
    }
    label {
        display: block;
        font-size: 18px;
        margin-bottom: 5px;
    }

    input[type="number"] {
        width: 50px;
        padding: 5px;
        font-size: 16px;
    }

    #timer {
        font-size: 48px;
        margin: 20px 0;
    }

    button {
        font-size: 18px;
        margin: 10px;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        background-color: #8b7cb3;
        color: #fff;
        cursor: pointer;
    }

    #startButton:hover {
        background-color: #03a516ad;
        color: black;
    }

    #pauseButton:hover {
        background-color: #ffb700ad;
        color: black;
    }

    #resetButton:hover {
        background-color: #e500359b;
        color: black;
    }

    #taskSelection {
            text-align: center;
            margin-bottom: 15px; 
        }

    </style>

<script>
    // script for handling the timer
    let timer;
    let isPaused = false;
    let currentTime = 0;
    let workTime = 25 * 60; 
    let shortBreakTime = 5 * 60; 
    let longBreakTime = 15 * 60; 
    let cycleCount = 0;
    
    function updateTimerDisplay() {
        const minutes = Math.floor(currentTime / 60);
        const seconds = currentTime % 60;
        const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        document.getElementById('timer').textContent = formattedTime;
    }
    
    function startTimer() {
        isPaused = false;
        timer = setInterval(() => {
            if (currentTime > 0) {
                currentTime--;
                updateTimerDisplay();
            } else {
                clearInterval(timer);
                if (cycleCount < 3) { // Check if it's time for a short break or long break
                    if (cycleCount === 2) {
                        currentTime = longBreakTime;
                        cycleCount = 0; // Reset the cycle count
                    } else {
                        currentTime = shortBreakTime;
                        cycleCount++;
                    }
                    playPingSound();
                    updateTimerDisplay();
                    startTimer();
                } else { // Time for a long break
                    currentTime = longBreakTime;
                    cycleCount = 0; // Reset the cycle count
                    playPingSound();
                    updateTimerDisplay();
                    startTimer();
                }
            }
        }, 1000);
    }

    function playPingSound() {
        const audio = new Audio("../static/subtle.mp3");
        audio.play();
    }
    
    document.getElementById('startButton').addEventListener('click', () => {
        if (isPaused) {
            startTimer();
        } else {
            const workTimeInput = parseInt(document.getElementById('workTime').value, 10) * 60;
            const shortBreakTimeInput = parseInt(document.getElementById('shortBreakTime').value, 10) * 60;
            const longBreakTimeInput = parseInt(document.getElementById('longBreakTime').value, 10) * 60;
            
            workTime = workTimeInput || workTime;
            shortBreakTime = shortBreakTimeInput || shortBreakTime;
            longBreakTime = longBreakTimeInput || longBreakTime;
            
            currentTime = workTime;
            updateTimerDisplay();
            startTimer();
        }
    });
    
    document.getElementById('pauseButton').addEventListener('click', () => {
        clearInterval(timer);
        isPaused = true;
    });
    
    document.getElementById('resetButton').addEventListener('click', () => {
        clearInterval(timer);
        isPaused = false;
        currentTime = workTime;
        updateTimerDisplay();
    });
</script>

<script>
    // JavaScript for handling task selection
const startButton = document.getElementById('startButton');
const taskSelection = document.getElementById('taskSelection');

startButton.addEventListener('click', () => {
  const selectedTaskId = taskSelection.value;

  if (!selectedTaskId) {
    // User hasn't selected a task, show an alert or provide feedback
    alert('The timer will begin without a concrete set task. It is recommended that you choose a task');
    return;
  }

  // Now you can use selectedTaskId in your Pomodoro timer logic
  // Start the timer for the selected task
  startPomodoro(selectedTaskId);
});

function startPomodoro(taskId) {
  // Implement Pomodoro timer logic here, change code!!!!!!!!!!! 
    // MUST UPDATE CODE LOGIC!!!!!!!!!! 
  // Start the timer for the selected task
}

</script>

<script>
    // JavaScript for handling the popup
    const pomodoroInfoLink = document.getElementById('pomodoroInfoLink');
    const popup = document.getElementById('popup');
    const closePopup = document.getElementById('closePopup');

    // Initially hide the popup
    popup.style.display = 'none';

    // Show the popup when clicking the "What is Pomodoro?" link
    pomodoroInfoLink.addEventListener('click', (event) => {
        event.preventDefault();
        popup.style.display = 'block';
    });

    // Close the popup when clicking the close button (x)
    closePopup.addEventListener('click', () => {
        popup.style.display = 'none';
    });
;
</script>
    {% endblock %}